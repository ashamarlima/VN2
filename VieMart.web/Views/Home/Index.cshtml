@{
    ViewData["Title"] = "URL Shortener";
}

<div class="container py-4" style="max-width:600px">
    <h2 class="mb-3 text-center">URL Shortener</h2>

    <div class="mb-3">
        <input id="longUrl" classx="form-control" placeholder="https://example.com/very/long/url" />
    </div>

    <button id="btnShorten" class="btn btn-primary w-100">Shorten</button>

    <div id="result" class="alert alert-success mt-3 d-none"></div>
    <div id="error" class="alert alert-danger mt-3 d-none"></div>
</div>

@section Scripts {
    <script>
        document.getElementById('btnShorten').addEventListener('click', async () => {
            const url = document.getElementById('longUrl').value.trim();
            const result = document.getElementById('result');
            const error = document.getElementById('error');
            result.classList.add('d-none');
            error.classList.add('d-none');

            try {
                const res = await fetch('/api/shorten', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });

                const data = await res.json();

                if (res.ok) {
                    const shortUrl = data.shortUrl || data.ShortUrl;
                    result.innerHTML = `<a href="${shortUrl}" target="_blank" class="text-white text-decoration-none fw-bold">${shortUrl}</a>`;
                    result.classList.remove('d-none');
                } else {
                    error.textContent = (data && (data.title || data.error || data)) || 'Invalid URL';
                    error.classList.remove('d-none');
                }
            } catch (e) {
                error.textContent = 'Request failed. Check console and API.';
                error.classList.remove('d-none');
                console.error(e);
            }
        });
    </script>
}
